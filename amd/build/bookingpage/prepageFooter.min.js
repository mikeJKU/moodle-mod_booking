define("mod_booking/bookingpage/prepageFooter",["exports","mod_booking/bookit","local_wunderbyte_table/reload"],(function(_exports,_bookit,_reload){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.closeInline=closeInline,_exports.closeModal=closeModal,_exports.hideModalFallback=hideModalFallback,_exports.initFooterButtons=function(optionid,userid,shoppingcartisinstalled){console.log("initFooterButtons",optionid);let selectorInline='[id^="'+SELECTORS_INLINEID+optionid+'_"]'+SELECTORS_INMODALFOOTER+" a",elements=Array.from(document.querySelectorAll(selectorInline));if(0===elements.length){let selectorModal='[id^="'+SELECTORS_MODALID+optionid+'_"]'+SELECTORS_INMODALFOOTER+" a";elements=Array.from(document.querySelectorAll(selectorModal));const modalSelectorAll='[id^="'+SELECTORS_MODALID+optionid+'_"]';Array.from(document.querySelectorAll(modalSelectorAll)).forEach((modalEl=>{modalEl.addEventListener("hide.bs.modal",(()=>{(0,_bookit.setBackModalVariables)(optionid)}))}))}console.log("buttons found",elements),elements.forEach((element=>{if(!element||element.dataset.initialized)return;element.dataset.initialized="1";const action=element.dataset.action;switch(console.log(element,action),action){case"closeinline":case"continuepost":case"checkout":console.log("closeinline/checkout/continuepost",action),shoppingcartisinstalled&&("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["local_shopping_cart/cart"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("local_shopping_cart/cart")):Promise.resolve(_systemImportTransformerGlobalIdentifier["local_shopping_cart/cart"])).then((module=>{const cart=module.default??module;console.log("cart module loaded",cart);const oncashier=window.location.href.indexOf("cashier.php");"function"==typeof cart.reinit&&(oncashier>0?cart.reinit(-1):cart.reinit())})).catch((()=>{console.log("local_shopping_cart/cart could not be loaded")})),function(optionid){const inlineSelectorAll='[id^="'+SELECTORS_INLINEID+optionid+'_"]';Array.from(document.querySelectorAll(inlineSelectorAll)).forEach((inlineEl=>{inlineEl.addEventListener("hide.bs.collapse",(()=>{(0,_reload.reloadAllTables)()}))}))}(optionid)}element.addEventListener("click",(function(evt){if(this.classList.contains("hidden"))return;if("true"===this.dataset.blocked)return;evt.preventDefault(),evt.stopImmediatePropagation();switch(this.dataset.action){case"back":(0,_bookit.backToPreviousPage)(optionid,userid);break;case"continue":case"continuepost":(0,_bookit.continueToNextPage)(optionid,userid);break;case"checkout":closeModal(optionid),this.dataset.href&&(window.location.href=this.dataset.href);break;case"closemodal":reloadOnBookingView(),closeModal(optionid);break;case"closeinline":reloadOnBookingView(),closeInline(optionid)}}))}))};var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};const SELECTORS_MODALID="sbPrePageModal_",SELECTORS_INLINEID="sbPrePageInline_",SELECTORS_INMODALFOOTER=" div.prepage-booking-footer";function closeModal(optionid){let reloadTables=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const modalSelectorAll='[id^="'+SELECTORS_MODALID+optionid+'_"]',modalEls=Array.from(document.querySelectorAll(modalSelectorAll));modalEls.forEach((modalEl=>{const onShown=e=>{modalEl.removeEventListener("shown.bs.modal",onShown),console.log("modal hide after shown",e);try{var _window$bootstrap;let modalInstance=(null===(_window$bootstrap=window.bootstrap)||void 0===_window$bootstrap?void 0:_window$bootstrap.Modal.getInstance(modalEl))??null;console.log("modal instance",modalInstance),modalInstance||void 0===window.bootstrap||(modalInstance=new window.bootstrap.Modal(modalEl)),modalInstance?(console.log("modal instance - to be hidden",modalInstance),modalInstance.hide()):(console.log("modalEl instance - DOM fallback",modalEl),hideModalFallback(modalEl))}catch(err){console.warn("Error hiding bootstrap modal instance",err),hideModalFallback(modalEl)}reloadTables&&(0,_reload.reloadAllTables)()};modalEl.addEventListener("shown.bs.modal",onShown);try{var _window$bootstrap2;let modalInstance=(null===(_window$bootstrap2=window.bootstrap)||void 0===_window$bootstrap2?void 0:_window$bootstrap2.Modal.getInstance(modalEl))??null;console.log("modal instance (immediate)",modalInstance),modalInstance||void 0===window.bootstrap||(modalInstance=new window.bootstrap.Modal(modalEl)),modalInstance?(console.log("modal instance - to be hidden (immediate)",modalInstance),modalInstance.hide()):(console.log("modalEl instance - DON fallback (immediate)",modalEl),hideModalFallback(modalEl))}catch(err){console.warn("Error hiding bootstrap modal instance (immediate)",err),hideModalFallback(modalEl)}reloadTables&&(0,_reload.reloadAllTables)()}))}function hideModalFallback(modalEl){if(!modalEl)return;modalEl.classList.remove("show"),modalEl.style.display="none",modalEl.setAttribute("aria-hidden","true"),modalEl.removeAttribute("aria-modal"),modalEl.removeAttribute("role"),document.body.classList.remove("modal-open");Array.from(document.querySelectorAll(".modal-backdrop")).forEach((backdrop=>{backdrop.parentNode&&backdrop.parentNode.removeChild(backdrop)}));try{const shownEvent=new CustomEvent("hidden.bs.modal",{bubbles:!0,cancelable:!0});modalEl.dispatchEvent(shownEvent)}catch(e){}}function closeInline(optionid){let reloadTables=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const inlineSelectorAll='[id^="'+SELECTORS_INLINEID+optionid+'_"]',inlineEls=Array.from(document.querySelectorAll(inlineSelectorAll));inlineEls.forEach((inlineEl=>{const onShown=e=>{inlineEl.removeEventListener("shown.bs.collapse",onShown),console.log("collapse hide after shown",e);try{var _window$bootstrap3;let collapseInstance=(null===(_window$bootstrap3=window.bootstrap)||void 0===_window$bootstrap3?void 0:_window$bootstrap3.Collapse.getInstance(inlineEl))??null;collapseInstance||void 0===window.bootstrap||(collapseInstance=new window.bootstrap.Collapse(inlineEl,{toggle:!1})),collapseInstance?collapseInstance.toggle():inlineEl.classList.toggle("show")}catch(err){console.warn("Error toggling bootstrap collapse instance",err)}reloadTables&&(0,_reload.reloadAllTables)()};inlineEl.addEventListener("shown.bs.collapse",onShown);try{var _window$bootstrap4;let collapseInstance=(null===(_window$bootstrap4=window.bootstrap)||void 0===_window$bootstrap4?void 0:_window$bootstrap4.Collapse.getInstance(inlineEl))??null;collapseInstance||void 0===window.bootstrap||(collapseInstance=new window.bootstrap.Collapse(inlineEl,{toggle:!1})),collapseInstance?collapseInstance.toggle():inlineEl.classList.toggle("show")}catch(err){console.warn("Error toggling bootstrap collapse instance (immediate)",err)}reloadTables&&(0,_reload.reloadAllTables)()}))}function reloadOnBookingView(){window.location.href.indexOf("optionview.php")>=0&&window.location.reload()}}));

//# sourceMappingURL=prepageFooter.min.js.map