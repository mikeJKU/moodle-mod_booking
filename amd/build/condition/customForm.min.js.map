{"version":3,"file":"customForm.min.js","sources":["../../src/condition/customForm.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * @module     mod_booking/condition/bookingPolicy\r\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport DynamicForm from 'core_form/dynamicform';\r\n\r\nconst SELECTOR = {\r\n    FORMCONTAINER: '.condition-customform',\r\n    PREPAGEBODY: '.prepage-body',\r\n    CONTINUECONTAINER: ' div.prepage-booking-footer .continue-container',\r\n    CONTINUEBUTTON: ' div.prepage-booking-footer .continue-button',\r\n    BOOKINGBUTTON: '[data-area=\"subbooking\"][data-itemid=\"',\r\n};\r\n\r\n/**\r\n * Init function.\r\n */\r\nexport async function init() {\r\n\r\n    let container = document.querySelector(\"div.modal.show \" + SELECTOR.FORMCONTAINER);\r\n\r\n    // If we don't find the container like this, we use the inline form.\r\n    if (!container) {\r\n        const containers = document.querySelectorAll(\"div.prepage-body \" + SELECTOR.FORMCONTAINER);\r\n        containers.forEach(el => {\r\n            if (!isHidden(el)) {\r\n                container = el;\r\n            }\r\n        });\r\n\r\n        if (!container) {\r\n            return;\r\n        }\r\n    }\r\n\r\n    // eslint-disable-next-line no-console\r\n    console.log(\"container\", container);\r\n\r\n    const id = container.dataset.id;\r\n    const userid = container.dataset.userid;\r\n\r\n    const dynamicForm = new DynamicForm(container, 'mod_booking\\\\form\\\\condition\\\\customform_form');\r\n\r\n    // We need to render the dynamic form right away, so we can acutally have all the necessary elements present.\r\n    await dynamicForm.load({\r\n        id,\r\n        userid,\r\n    });\r\n\r\n    let continuebutton = container.closest(SELECTOR.PREPAGEBODY).querySelector(SELECTOR.CONTINUEBUTTON);\r\n\r\n    // eslint-disable-next-line no-console\r\n    console.log(\"continuebutton\", continuebutton);\r\n\r\n    dynamicForm.addEventListener(dynamicForm.events.FORM_SUBMITTED, e => {\r\n\r\n        const response = e.detail;\r\n\r\n        // eslint-disable-next-line no-console\r\n        console.log(\"response\", response, continuebutton);\r\n\r\n        if (response) {\r\n\r\n            if (!continuebutton) {\r\n                continuebutton = container.closest(SELECTOR.PREPAGEBODY).querySelector(SELECTOR.CONTINUEBUTTON);\r\n            }\r\n            if (continuebutton) {\r\n\r\n                continuebutton.dataset.blocked = 'false';\r\n                continuebutton.click();\r\n            }\r\n        }\r\n    });\r\n\r\n    // This goes on continue button.\r\n    // It will prevent the action to be triggered.\r\n    // Unless the form is validated (see above).\r\n    if (continuebutton) {\r\n\r\n        continuebutton.dataset.blocked = true;\r\n\r\n        continuebutton.addEventListener('click', () => {\r\n\r\n            if (continuebutton.dataset.blocked == 'true') {\r\n\r\n                dynamicForm.submitFormAjax();\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Function to check visibility of element.\r\n * @param {*} el\r\n * @returns {boolean}\r\n */\r\nfunction isHidden(el) {\r\n    var style = window.getComputedStyle(el);\r\n    return ((style.display === 'none') || (style.visibility === 'hidden'));\r\n}"],"names":["container","document","querySelector","SELECTOR","querySelectorAll","forEach","el","style","window","getComputedStyle","display","visibility","isHidden","console","log","id","dataset","userid","dynamicForm","DynamicForm","load","continuebutton","closest","addEventListener","events","FORM_SUBMITTED","e","response","detail","blocked","click","submitFormAjax"],"mappings":";;;;;gGAoCQA,UAAYC,SAASC,cAAc,kBAAoBC,4BAGtDH,UAAW,IACOC,SAASG,iBAAiB,oBAAsBD,wBACxDE,SAAQC,eAwETA,QACVC,MAAQC,OAAOC,iBAAiBH,UACT,SAAlBC,MAAMG,SAA6C,WAArBH,MAAMI,YAzEhCC,CAASN,MACVN,UAAYM,QAIfN,iBAMTa,QAAQC,IAAI,YAAad,iBAEnBe,GAAKf,UAAUgB,QAAQD,GACvBE,OAASjB,UAAUgB,QAAQC,OAE3BC,YAAc,IAAIC,qBAAYnB,UAAW,uDAGzCkB,YAAYE,KAAK,CACnBL,GAAAA,GACAE,OAAAA,aAGAI,eAAiBrB,UAAUsB,QAAQnB,sBAAsBD,cAAcC,yBAG3EU,QAAQC,IAAI,iBAAkBO,gBAE9BH,YAAYK,iBAAiBL,YAAYM,OAAOC,gBAAgBC,UAEtDC,SAAWD,EAAEE,OAGnBf,QAAQC,IAAI,WAAYa,SAAUN,gBAE9BM,WAEKN,iBACDA,eAAiBrB,UAAUsB,QAAQnB,sBAAsBD,cAAcC,0BAEvEkB,iBAEAA,eAAeL,QAAQa,QAAU,QACjCR,eAAeS,aAQvBT,iBAEAA,eAAeL,QAAQa,SAAU,EAEjCR,eAAeE,iBAAiB,SAAS,KAEC,QAAlCF,eAAeL,QAAQa,SAEvBX,YAAYa,8FA/EtB5B,uBACa,wBADbA,qBAEW,gBAFXA,wBAIc"}